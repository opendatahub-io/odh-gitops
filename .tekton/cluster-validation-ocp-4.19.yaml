---
apiVersion: tekton.dev/v1
kind: PipelineRun
metadata:
  name: cluster-validation-ocp419-pr{{ pull_request_number }}-{{ revision }}
  labels:
    appstudio.openshift.io/application: odh-gitops
    appstudio.openshift.io/component: cluster-validation-ocp-419
    pipelines.appstudio.openshift.io/type: test
  annotations:
    pipelinesascode.tekton.dev/on-cel-expression: |
      event == "pull_request" &&
      files.all.exists(file,
        !file.startsWith('.github/') &&
        !file.startsWith('chart/') &&
        file != '.gitignore' &&
        file != '.kube-linter.yaml' &&
        file != '.yamllint.yaml' &&
        file != 'LICENSE' &&
        file != 'Makefile' &&
        !file.endsWith('.md')
      )
    pipelinesascode.tekton.dev/on-comment: "^/validate-dependencies"
    pipelinesascode.tekton.dev/max-keep-runs: "3"
spec:
  pipelineRef:
    resolver: git
    params:
      - name: url
        value: "{{source_url}}"
      - name: revision
        value: "{{revision}}"
      - name: pathInRepo
        value: .tekton/pipelines/cluster-validation-pipeline.yaml
  params:
    - name: git-url
      value: "{{source_url}}"
    - name: revision
      value: "{{revision}}"
    - name: ocp-version
      value: "4.19.0"
    - name: validation-type
      value: "kustomize"
  taskRunTemplate:
    serviceAccountName: build-pipeline-cluster-validation-ocp-419
